{% extends 'base.html' %}
{% load static i18n %}

{% block content %}
{% include 'partials/navbar2.html' %}

<main>
  <!-- =======================
  Main Banner START -->
  <section class="pt-0">
    <div class="container">
      <!-- Background image -->
      <div class="p-3 p-sm-5 rounded-3"
           style="background-image: url({% static 'images/bg/04.jpg' %}); background-position: center center; background-repeat: no-repeat; background-size: cover;">
        <!-- Banner title -->
        <div class="row justify-content-between pt-0 pb-5">
        </div>
      </div>

      <!-- Search START -->
      <div class="row mt-n7 mt-9">
        <div class="col-11 mx-auto">
          <!-- Booking form START -->
          <form method="get" action="{% url 'pages:search_trip' %}" class="bg-mode shadow rounded-3 p-4">
            <div class="row g-4 align-items-center">
              <div class="col-xl-10">
                <div class="row g-4">
                  <!-- Location -->
                  <div>
                    <label class="h6 fw-normal mb-0"><i class="bi bi-geo-alt text-primary me-1"></i>Destination</label>
                    <div class="form-border-bottom form-control-transparent form-fs-lg mt-2">
                      <input type="text" name="location" class="form-control" placeholder="Recherchez une destination..." value="{{ selected_location }}">
                    </div>
                  </div>
                </div>
              </div>
              <!-- Button -->
              <div class="col-xl-2">
                <div class="d-grid">
                  <button type="submit" class="btn btn-lg btn-dark mb-0">Rechercher</button>
                </div>
              </div>
            </div>
          </form>
          <!-- Booking form END -->
          <div class="row g-4 mt-4">
            {% for trip in trips %}
            <div class="col-md-6 col-lg-4">
              <a href="{% url 'pages:trip_detail' trip.id %}" style="text-decoration: none; color: inherit;">
                <div style="
                  border-radius: 16px;
                  overflow: hidden;
                  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
                  transition: transform 0.3s ease, box-shadow 0.3s ease;
                  background: #fff;
                  height: 100%;
                  display: flex;
                  flex-direction: column;
                "
                     onmouseover="this.style.transform='translateY(-6px)'; this.style.boxShadow='0 12px 25px rgba(0,0,0,0.15)';"
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.1)';"
                >
                  <!-- Image -->
                  <div style="position: relative; height: 220px; overflow: hidden;">
                    <img src="{{ trip.image|default:'/static/images/category/tour/4by3/01.jpg' }}"
                         alt="{{ trip.title }}"
                         style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s ease;"
                         onmouseover="this.style.transform='scale(1.08)';"
                         onmouseout="this.style.transform='scale(1)';">
                    <span style="
                      position: absolute;
                      bottom: 12px;
                      left: 12px;
                      background: rgba(0,0,0,0.7);
                      color: #fff;
                      padding: 6px 12px;
                      font-size: 0.9rem;
                      border-radius: 12px;
                    ">
                      {{ trip.arrival_city }}
                    </span>
                  </div>
                  <!-- Contenu -->
                  <div style="padding: 18px; flex: 1; display: flex; flex-direction: column; justify-content: space-between;">
                    <h5 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 8px; color: #333;">
                      {{ trip.title }}
                    </h5>
                    <p style="flex: 1; color: #666; font-size: 0.95rem; margin-bottom: 12px;">
                      {{ trip.description|truncatewords:15 }}
                    </p>
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                      <span style="font-weight: 700; font-size: 1.1rem; color: #2c3e50;">
                        {{ trip.price }} €
                      </span>
                      <span style="
                        background: #007bff;
                        color: #fff;
                        font-size: 0.85rem;
                        padding: 6px 12px;
                        border-radius: 20px;
                      ">
                        {{ trip.duration }}
                      </span>
                    </div>
                  </div>
                </div>
              </a>
            </div>
            {% empty %}
            <p style="text-align:center; color:#666;">Aucun voyage trouvé.</p>
            {% endfor %}
          </div>
        </div>
      </div>
      <!-- Search END -->

      <!-- Alert box START -->
      <div class="alert alert-danger d-flex align-items-center mt-5 rounded-3 mb-0" role="alert">
        <span class="h4 mb-0 alert-heading"><i class="bi bi-exclamation-octagon-fill me-2"></i></span>
        <div class="ms-3">
          <h6 class="mb-0 alert-heading">Dépêchez-vous ! 51% des voyages sont déjà réservés</h6>
          <p class="mb-0">De nombreux voyages vers diverses destinations ont été réservés, ne manquez pas cette opportunité !</p>
        </div>
      </div>
      <!-- Alert box END -->
    </div>
  </section>
  <!-- =======================
  Main Banner END -->

  <!-- =======================
  Tour grid START -->
  <section class="pt-0">
    <div class="container">
      <!-- Filter and content START -->
      <div class="row g-4 align-items-center justify-content-between mb-4">
        <!-- Content -->
        <div class="col-12 col-xl-8">
          <h5 class="mb-0">Affichage de {{ trips.count }} résultats</h5>
        </div>
        <!-- Select option -->
        <div class="col-xl-2">
          <form class="form-control-bg-light">
            <select class="form-select js-choice">
              <option value="">Les plus consultés</option>
              <option>Recherches récentes</option>
              <option>Les plus populaires</option>
              <option>Mieux notés</option>
            </select>
          </form>
        </div>
      </div>
      <!-- Filter and content END -->

      <div class="row g-4">
        {% for trip in trips %}
        <div class="col-md-6 col-xl-4">
          <div class="card card-hover-shadow pb-0 h-100">
            <!-- Overlay item -->
            <div class="position-relative">
              <!-- Image -->
              <img src="{{ trip.image|default:'/static/images/category/tour/4by3/01.jpg' }}"
                   class="card-img-top"
                   alt="{{ trip.title }}">
              <!-- Overlay -->
              <div class="card-img-overlay d-flex flex-column p-4 z-index-1">
                <!-- Card overlay top -->
                <div>
                  {% if trip.is_best_trip %}
                  <span class="badge text-bg-danger">Meilleure offre</span>
                  {% endif %}
                  <span class="badge text-bg-dark">{{ trip.vehicle_type }}</span>
                </div>
                <!-- Card overlay bottom -->
                <div class="w-100 mt-auto">
                  <span class="badge text-bg-white fs-6">{{ trip.duration }}</span>
                </div>
              </div>
            </div>
            <!-- Card body START -->
            <div class="card-body px-3">
              <!-- Title -->
              <h5 class="card-title mb-0">
                <a href="{% url 'pages:trip_detail' trip.id %}" class="stretched-link">{{ trip.title }}</a>
              </h5>
              <span class="small"><i class="far fa-calendar-alt me-2"></i>{{ trip.created_at|date:"d M Y" }}</span>
              <!-- List -->
              <ul class="nav nav-divider mt-3 mb-0">
                {% if trip.vehicle_type == "Avion" %}
                <li class="nav-item h6 fw-normal mb-0">
                  <i class="fa-solid fa-plane text-orange me-2"></i>1 Vol
                </li>
                {% endif %}
                <li class="nav-item h6 fw-normal mb-0">
                  <i class="fa-solid fa-hotel text-info me-2"></i>1 Hôtel
                </li>
                <li class="nav-item h6 fw-normal mb-0">
                  <i class="fa-solid fa-person-skating text-danger me-2"></i>2 Activités
                </li>
              </ul>
            </div>
            <!-- Card body END -->
            <!-- Card footer START -->
            <div class="card-footer pt-0">
              <!-- Price and Button -->
              <div class="d-sm-flex justify-content-sm-between align-items-center flex-wrap">
                <!-- Price -->
                <div class="hstack gap-2">
                  <h5 class="fw-normal text-success mb-0">{{ trip.price }} €</h5>
                  <small>/par personne</small>
                  {% if trip.is_best_trip %}
                  <span class="text-decoration-line-through">{{ trip.price|add:200 }} €</span>
                  {% endif %}
                </div>
                <!-- Button -->
                <div class="mt-2 mt-sm-0">
                  <a href="{% url 'pages:trip_detail' trip.id %}" class="btn btn-sm btn-primary mb-0">Voir les détails</a>
                </div>
              </div>
            </div>
            <!-- Card footer END -->
          </div>
        </div>
        {% empty %}
        <p style="text-align:center; color:#666;">Aucun voyage disponible.</p>
        {% endfor %}
      </div>
      <!-- Pagination -->
      <div class="row">
        <div class="col-12">
          <nav class="mt-4 d-flex justify-content-center" aria-label="navigation">
            <ul class="pagination pagination-primary-soft d-inline-block d-md-flex rounded mb-0">
              <li class="page-item mb-0"><a class="page-link" href="#" tabindex="-1"><i class="fa-solid fa-angle-left"></i></a></li>
              <li class="page-item mb-0"><a class="page-link" href="#">1</a></li>
              <li class="page-item mb-0 active"><a class="page-link" href="#">2</a></li>
              <li class="page-item mb-0"><a class="page-link" href="#">..</a></li>
              <li class="page-item mb-0"><a class="page-link" href="#">6</a></li>
              <li class="page-item mb-0"><a class="page-link" href="#"><i class="fa-solid fa-angle-right"></i></a></li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </section>
  <!-- =======================
  Tour grid END -->
</main>

{% include 'partials/footer.html' %}
{% endblock content %}
