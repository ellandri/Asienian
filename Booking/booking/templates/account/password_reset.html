{% extends 'base.html' %}
{% load static i18n %}

{% block content %}
<main class="min-vh-100 position-relative overflow-hidden">
  <!-- Fond animé moderne -->
  <div class="position-absolute w-100 h-100" style="
    background: linear-gradient(135deg, #d8f8e7 0%, #e1f3ff 50%, #e1f3ff 100%);
    z-index: -3;
  "></div>

  <!-- Motifs géométriques animés -->
  <div class="position-absolute w-100 h-100" style="z-index: -2;">
    <div class="position-absolute rounded-circle" style="
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      top: -150px;
      right: -150px;
      animation: pulse 8s ease-in-out infinite;
    "></div>
    <div class="position-absolute rounded-circle" style="
      width: 200px;
      height: 200px;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      bottom: -100px;
      left: -100px;
      animation: pulse 6s ease-in-out infinite reverse;
    "></div>
    <div class="position-absolute" style="
      width: 80px;
      height: 80px;
      background: linear-gradient(45deg, rgba(255,255,255,0.1), transparent);
      top: 20%;
      left: 10%;
      transform: rotate(45deg);
      animation: rotate 15s linear infinite;
    "></div>
  </div>

  <!-- Grille de points décorative -->
  <div class="position-absolute w-100 h-100 opacity-20" style="
    background-image: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
    background-size: 30px 30px;
    z-index: -1;
  "></div>

  <section class="vh-xxl-100">
    <div class="container h-100 d-flex px-0 px-sm-4">
      <div class="row justify-content-center align-items-center m-auto">
        <div class="col-12">
          <div class="shadow-lg rounded-4 overflow-hidden position-relative" style="
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
          ">
            <div class="row g-0">

              <!-- Image vectorielle -->
              <div class="col-lg-6 d-md-flex align-items-center order-2 order-lg-1 position-relative">
                <div class="position-absolute w-100 h-100" style="
                  background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
                "></div>
                <div class="text-center position-relative z-index-2">
                      <img src="https://images.unsplash.com/photo-1645620413090-f458f39aea04?q=80&w=735&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                           alt="Forgot Password Illustration"
                           class="img-fluid rounded-3 shadow-sm"
                           style="filter: drop-shadow(0 10px 30px rgba(102, 126, 234, 0.2));object-fit: cover;width: 100%; height: 100%;">
                      <!-- Effet de brillance sur l'image -->
                      <div class="position-absolute top-0 start-0 w-100 h-100 rounded-3" style="
                        background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.2) 50%, transparent 70%);
                        animation: shine 3s ease-in-out infinite;
                      "></div>

                  <!-- Éléments décoratifs -->
                </div>
                <div class="vr opacity-1 d-none d-lg-block" style="background: linear-gradient(to bottom, transparent, rgba(102, 126, 234, 0.3), transparent);"></div>
              </div>

              <!-- Informations du formulaire -->
              <div class="col-lg-6 order-1">
                <div class="p-4 p-sm-7 position-relative">
                  <!-- Header avec logo -->
                  <div class="text-center mb-4">
                    <a href="/" class="d-inline-block position-relative">
                      <img src="{% static 'images/bg/logo (1).png' %}" alt="logo" style="width: 150px; filter: drop-shadow(0 5px 15px rgba(102, 126, 234, 0.3));">
                    </a>
                  </div>

                  <!-- Titre avec effet gradient -->
                  <div class="text-center mb-4">
                    <h1 class="mb-3 fw-bold" style="
                      background: #09552c;
                      -webkit-background-clip: text;
                      -webkit-text-fill-color: transparent;
                      font-size: 2.2rem;
                    ">{% trans "Mot de passe oublié ?" %}</h1>
                    <p class="text-muted fs-6 lh-base mb-0">{% trans "Entrez l'adresse e-mail associée à votre compte." %}</p>
                  </div>

                  <!-- Formulaire START -->
                  <form method="post" action="{% url 'account_reset_password' %}" class="mt-4 text-start">
                    {% csrf_token %}

                    <!-- Afficher les erreurs non-field -->
                    {% if form.non_field_errors %}
                    <div class="alert alert-danger border-0 rounded-3 shadow-sm" style="
                      background: linear-gradient(135deg, rgba(220, 53, 69, 0.1), rgba(220, 53, 69, 0.05));
                      border-left: 4px solid #dc3545 !important;
                    ">
                      {% for error in form.non_field_errors %}
                      <p class="mb-0 fw-medium">{{ error }}</p>
                      {% endfor %}
                    </div>
                    {% endif %}

                    <!-- Afficher les erreurs de champs -->
                    {% for field in form %}
                    {% if field.errors %}
                    <div class="alert alert-danger border-0 rounded-3 shadow-sm" style="
                      background: linear-gradient(135deg, rgba(220, 53, 69, 0.1), rgba(220, 53, 69, 0.05));
                      border-left: 4px solid #dc3545 !important;
                    ">
                      {% for error in field.errors %}
                      <p class="mb-0 fw-medium">{{ error }}</p>
                      {% endfor %}
                    </div>
                    {% endif %}
                    {% endfor %}

                    <!-- Input Email avec style moderne -->
                    <div class="mb-4">
                      <label for="id_email" class="form-label fw-semibold text-dark mb-3">
                        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24" class="me-2">
                          <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                        </svg>
                        {% trans "Adresse e-mail" %}
                      </label>
                      <div class="position-relative">
                        <input type="email"
                               name="email"
                               id="id_email"
                               class="form-control form-control-lg border-0 rounded-3 ps-4 py-3 shadow-sm"
                               required
                               placeholder="{% trans 'Entrez votre e-mail' %}"
                               style="
                                 background: rgba(102, 126, 234, 0.05);
                                 border: 2px solid transparent !important;
                                 transition: all 0.3s ease;
                               "
                               onfocus="this.style.background='white'; this.style.borderColor='#0b5917 !important'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)';"
                               onblur="this.style.background='rgba(102, 126, 234, 0.05)'; this.style.borderColor='transparent'; this.style.boxShadow='0 2px 10px rgba(0,0,0,0.1)';">
                        <div class="position-absolute top-50 end-0 translate-middle-y me-3">
                          <svg width="20" height="20" fill="#0b5917" viewBox="0 0 24 24">
                            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                          </svg>
                        </div>
                      </div>
                    </div>

                    <!-- Lien de retour avec style moderne -->
                    <div class="mb-4 text-center">
                      <p class="text-muted mb-0">
                        {% trans "Retour à" %}
                        <a href="{% url 'pages:dynamic_pages' template_name='index-tour' %}"
                           class="text-decoration-none fw-semibold position-relative"
                           style="
                             background: linear-gradient(135deg, #0b5917, #37ac09);
                             -webkit-background-clip: text;
                             -webkit-text-fill-color: transparent;
                           ">
                          {% trans "Connexion" %}
                          <span class="position-absolute bottom-0 start-0 w-100 h-1" style="
                             background: linear-gradient(135deg, #095313, #37ac09);
                            transform: scaleX(0);
                            transition: transform 0.3s ease;
                          "></span>
                        </a>
                      </p>
                    </div>

                    <!-- Bouton Submit moderne -->
                    <div class="d-grid mb-4">
                      <button type="submit"
                              class="btn btn-lg text-white fw-semibold py-3 border-0 rounded-3 position-relative overflow-hidden"
                              style="
                                background: linear-gradient(135deg, #178837, #37ac09);
                                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
                                transition: all 0.3s ease;
                              "
                              onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 12px 35px rgba(102, 126, 234, 0.5)';"
                              onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.4)';">

                        <span class="position-relative z-index-2">
                          <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24" class="me-2">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                          </svg>
                          {% trans "Réinitialiser le mot de passe" %}
                        </span>

                        <!-- Effet de brillance -->
                        <div class="position-absolute top-0 start-0 w-100 h-100 opacity-0" style="
                          background: linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent);
                          transition: opacity 0.3s ease;
                        "></div>
                      </button>
                    </div>
                  </form>
                  <!-- Formulaire END -->

                  <!-- Modal moderne pour confirmation -->
                  <div class="modal fade" id="resetDoneModal" tabindex="-1" aria-labelledby="resetDoneModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                      <div class="modal-content border-0 rounded-4 shadow-lg" style="
                        backdrop-filter: blur(20px);
                        background: rgba(255, 255, 255, 0.98);
                      ">
                        <div class="modal-header border-0 pb-0">
                          <div class="w-100 text-center">
                            <div class="d-inline-flex align-items-center justify-content-center rounded-circle mb-3" style="
                              width: 70px;
                              height: 70px;
                              background: linear-gradient(135deg, #0b5917, #37ac09);
                              box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
                            ">
                              <svg width="35" height="35" fill="white" viewBox="0 0 24 24">
                                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                              </svg>
                            </div>
                            <h5 class="modal-title fw-bold" id="resetDoneModalLabel" style="
                              background: linear-gradient(135deg, #0b5917, #37ac09);
                              -webkit-background-clip: text;
                              -webkit-text-fill-color: transparent;
                              font-size: 1.5rem;
                            ">{% trans "E-mail envoyé" %}</h5>
                          </div>
                          <button type="button" class="btn-close opacity-50" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body text-center px-4">
                          <div class="mb-4">
                            <img src="{% static 'images/logo-icon.svg' %}" alt="Asieniantour Logo" class="h-50px">
                          </div>
                          <p class="text-muted lh-base">{% trans "Nous vous avons envoyé un e-mail avec des instructions pour réinitialiser votre mot de passe. Vérifiez votre boîte de réception ou votre dossier de spam." %}</p>
                        </div>
                        <div class="modal-footer border-0 pt-0 justify-content-center">
                          <a href="{% url 'pages:dynamic_pages' template_name='sign-in' %}"
                             class="btn btn-lg text-white fw-semibold px-4 py-2 border-0 rounded-3"
                             style="
                               background: linear-gradient(135deg, #0b5917, #37ac09);
                               box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
                             ">{% trans "Retour à la connexion" %}</a>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Copyright moderne -->
                  <div class="text-center mt-4">
                    <p class="text-muted small mb-0">
                      &copy;2025
                      <span style="
                        background: linear-gradient(135deg, #0b5917, #37ac09);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        font-weight: 600;
                      ">Asieniantour</span>
                    </p>
                  </div>
                </div>
              </div>
              <!-- /Informations du formulaire -->

            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- JavaScript pour déclencher le modal -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      {% if show_modal %}
      var resetDoneModal = new bootstrap.Modal(document.getElementById('resetDoneModal'));
      resetDoneModal.show();
      {% endif %}

      // Animation pour le lien de retour
      document.querySelector('a[href*="sign-in"]').addEventListener('mouseover', function() {
        this.querySelector('span').style.transform = 'scaleX(1)';
      });

      document.querySelector('a[href*="sign-in"]').addEventListener('mouseout', function() {
        this.querySelector('span').style.transform = 'scaleX(0)';
      });
    });
  </script>
</main>

<style>
  @keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 0.7; }
    50% { transform: scale(1.1); opacity: 1; }
  }

  @keyframes rotate {
    from { transform: rotate(45deg); }
    to { transform: rotate(405deg); }
  }

  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }

  @keyframes shine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  .btn:focus {
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.25) !important;
  }

  .form-control:focus {
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
  }

  @media (max-width: 768px) {
    .rounded-4 {
      border-radius: 1rem !important;
      margin: 1rem;
    }

    .col-lg-6.order-1 .p-4.p-sm-7 {
      padding: 2rem 1.5rem !important;
    }

    h1 {
      font-size: 1.8rem !important;
    }
  }

  /* Effet de survol pour les éléments interactifs */
  .btn:hover .opacity-0 {
    opacity: 1 !important;
  }
</style>
{% endblock content %}
